var Ct=Object.create;var de=Object.defineProperty;var Nt=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Pt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var Ft=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),$t=(a,s)=>{for(var o in s)de(a,o,{get:s[o],enumerable:!0})},hn=(a,s,o,y)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of Dt(s))!Rt.call(a,c)&&c!==o&&de(a,c,{get:()=>s[c],enumerable:!(y=Nt(s,c))||y.enumerable});return a};var Bt=(a,s,o)=>(o=a!=null?Ct(Pt(a)):{},hn(s||!a||!a.__esModule?de(o,"default",{value:a,enumerable:!0}):o,a)),jt=a=>hn(de({},"__esModule",{value:!0}),a);var mn=Ft((dn,Me)=>{(function(a){if(typeof dn=="object"&&typeof Me<"u")Me.exports=a();else if(typeof define=="function"&&define.amd)define([],a);else{var s;typeof window<"u"?s=window:typeof global<"u"?s=global:typeof self<"u"?s=self:s=this,s.localforage=a()}})(function(){var a,s,o;return function y(c,g,E){function A(S,G){if(!g[S]){if(!c[S]){var b=typeof require=="function"&&require;if(!G&&b)return b(S,!0);if(m)return m(S,!0);var x=new Error("Cannot find module '"+S+"'");throw x.code="MODULE_NOT_FOUND",x}var R=g[S]={exports:{}};c[S][0].call(R.exports,function($){var V=c[S][1][$];return A(V||$)},R,R.exports,y,c,g,E)}return g[S].exports}for(var m=typeof require=="function"&&require,I=0;I<E.length;I++)A(E[I]);return A}({1:[function(y,c,g){(function(E){"use strict";var A=E.MutationObserver||E.WebKitMutationObserver,m;if(A){var I=0,S=new A($),G=E.document.createTextNode("");S.observe(G,{characterData:!0}),m=function(){G.data=I=++I%2}}else if(!E.setImmediate&&typeof E.MessageChannel<"u"){var b=new E.MessageChannel;b.port1.onmessage=$,m=function(){b.port2.postMessage(0)}}else"document"in E&&"onreadystatechange"in E.document.createElement("script")?m=function(){var B=E.document.createElement("script");B.onreadystatechange=function(){$(),B.onreadystatechange=null,B.parentNode.removeChild(B),B=null},E.document.documentElement.appendChild(B)}:m=function(){setTimeout($,0)};var x,R=[];function $(){x=!0;for(var B,X,j=R.length;j;){for(X=R,R=[],B=-1;++B<j;)X[B]();j=R.length}x=!1}c.exports=V;function V(B){R.push(B)===1&&!x&&m()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(y,c,g){"use strict";var E=y(1);function A(){}var m={},I=["REJECTED"],S=["FULFILLED"],G=["PENDING"];c.exports=b;function b(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=G,this.queue=[],this.outcome=void 0,d!==A&&V(this,d)}b.prototype.catch=function(d){return this.then(null,d)},b.prototype.then=function(d,O){if(typeof d!="function"&&this.state===S||typeof O!="function"&&this.state===I)return this;var _=new this.constructor(A);if(this.state!==G){var N=this.state===S?d:O;R(_,N,this.outcome)}else this.queue.push(new x(_,d,O));return _};function x(d,O,_){this.promise=d,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}x.prototype.callFulfilled=function(d){m.resolve(this.promise,d)},x.prototype.otherCallFulfilled=function(d){R(this.promise,this.onFulfilled,d)},x.prototype.callRejected=function(d){m.reject(this.promise,d)},x.prototype.otherCallRejected=function(d){R(this.promise,this.onRejected,d)};function R(d,O,_){E(function(){var N;try{N=O(_)}catch(M){return m.reject(d,M)}N===d?m.reject(d,new TypeError("Cannot resolve promise with itself")):m.resolve(d,N)})}m.resolve=function(d,O){var _=B($,O);if(_.status==="error")return m.reject(d,_.value);var N=_.value;if(N)V(d,N);else{d.state=S,d.outcome=O;for(var M=-1,L=d.queue.length;++M<L;)d.queue[M].callFulfilled(O)}return d},m.reject=function(d,O){d.state=I,d.outcome=O;for(var _=-1,N=d.queue.length;++_<N;)d.queue[_].callRejected(O);return d};function $(d){var O=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof O=="function")return function(){O.apply(d,arguments)}}function V(d,O){var _=!1;function N(U){_||(_=!0,m.reject(d,U))}function M(U){_||(_=!0,m.resolve(d,U))}function L(){O(M,N)}var q=B(L);q.status==="error"&&N(q.value)}function B(d,O){var _={};try{_.value=d(O),_.status="success"}catch(N){_.status="error",_.value=N}return _}b.resolve=X;function X(d){return d instanceof this?d:m.resolve(new this(A),d)}b.reject=j;function j(d){var O=new this(A);return m.reject(O,d)}b.all=Ae;function Ae(d){var O=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=d.length,N=!1;if(!_)return this.resolve([]);for(var M=new Array(_),L=0,q=-1,U=new this(A);++q<_;)Y(d[q],q);return U;function Y(ue,he){O.resolve(ue).then(Se,function(re){N||(N=!0,m.reject(U,re))});function Se(re){M[he]=re,++L===_&&!N&&(N=!0,m.resolve(U,M))}}}b.race=ne;function ne(d){var O=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=d.length,N=!1;if(!_)return this.resolve([]);for(var M=-1,L=new this(A);++M<_;)q(d[M]);return L;function q(U){O.resolve(U).then(function(Y){N||(N=!0,m.resolve(L,Y))},function(Y){N||(N=!0,m.reject(L,Y))})}}},{1:1}],3:[function(y,c,g){(function(E){"use strict";typeof E.Promise!="function"&&(E.Promise=y(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(y,c,g){"use strict";var E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var I=m();function S(){try{if(!I||!I.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||t)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function G(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if(r.name!=="TypeError")throw r;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,i=new n,u=0;u<e.length;u+=1)i.append(e[u]);return i.getBlob(t.type)}}typeof Promise>"u"&&y(3);var b=Promise;function x(e,t){t&&e.then(function(n){t(null,n)},function(n){t(n)})}function R(e,t,n){typeof t=="function"&&e.then(t),typeof n=="function"&&e.catch(n)}function $(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function V(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var B="local-forage-detect-blob-support",X=void 0,j={},Ae=Object.prototype.toString,ne="readonly",d="readwrite";function O(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),u=0;u<t;u++)i[u]=e.charCodeAt(u);return n}function _(e){return new b(function(t){var n=e.transaction(B,d),i=G([""]);n.objectStore(B).put(i,"key"),n.onabort=function(u){u.preventDefault(),u.stopPropagation(),t(!1)},n.oncomplete=function(){var u=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!u||parseInt(u[1],10)>=43)}}).catch(function(){return!1})}function N(e){return typeof X=="boolean"?b.resolve(X):_(e).then(function(t){return X=t,X})}function M(e){var t=j[e.name],n={};n.promise=new b(function(i,u){n.resolve=i,n.reject=u}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function L(e){var t=j[e.name],n=t.deferredOperations.pop();if(n)return n.resolve(),n.promise}function q(e,t){var n=j[e.name],i=n.deferredOperations.pop();if(i)return i.reject(t),i.promise}function U(e,t){return new b(function(n,i){if(j[e.name]=j[e.name]||We(),e.db)if(t)M(e),e.db.close();else return n(e.db);var u=[e.name];t&&u.push(e.version);var r=I.open.apply(I,u);t&&(r.onupgradeneeded=function(l){var f=r.result;try{f.createObjectStore(e.storeName),l.oldVersion<=1&&f.createObjectStore(B)}catch(p){if(p.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+l.oldVersion+" to version "+l.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw p}}),r.onerror=function(l){l.preventDefault(),i(r.error)},r.onsuccess=function(){var l=r.result;l.onversionchange=function(f){f.target.close()},n(l),L(e)}})}function Y(e){return U(e,!1)}function ue(e){return U(e,!0)}function he(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,u=e.version>e.db.version;if(i&&(e.version!==t&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),u||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function Se(e){return new b(function(t,n){var i=new FileReader;i.onerror=n,i.onloadend=function(u){var r=btoa(u.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},i.readAsBinaryString(e)})}function re(e){var t=O(atob(e.data));return G([t],{type:e.type})}function Ve(e){return e&&e.__local_forage_encoded_blob}function Nn(e){var t=this,n=t._initReady().then(function(){var i=j[t._dbInfo.name];if(i&&i.dbReady)return i.dbReady});return R(n,e,e),n}function Dn(e){M(e);for(var t=j[e.name],n=t.forages,i=0;i<n.length;i++){var u=n[i];u._dbInfo.db&&(u._dbInfo.db.close(),u._dbInfo.db=null)}return e.db=null,Y(e).then(function(r){return e.db=r,he(e)?ue(e):r}).then(function(r){e.db=t.db=r;for(var l=0;l<n.length;l++)n[l]._dbInfo.db=r}).catch(function(r){throw q(e,r),r})}function K(e,t,n,i){i===void 0&&(i=1);try{var u=e.db.transaction(e.storeName,t);n(null,u)}catch(r){if(i>0&&(!e.db||r.name==="InvalidStateError"||r.name==="NotFoundError"))return b.resolve().then(function(){if(!e.db||r.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),ue(e)}).then(function(){return Dn(e).then(function(){K(e,t,n,i-1)})}).catch(n);n(r)}}function We(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Pn(e){var t=this,n={db:null};if(e)for(var i in e)n[i]=e[i];var u=j[n.name];u||(u=We(),j[n.name]=u),u.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Nn);var r=[];function l(){return b.resolve()}for(var f=0;f<u.forages.length;f++){var p=u.forages[f];p!==t&&r.push(p._initReady().catch(l))}var h=u.forages.slice(0);return b.all(r).then(function(){return n.db=u.db,Y(n)}).then(function(v){return n.db=v,he(n,t._defaultConfig.version)?ue(n):v}).then(function(v){n.db=u.db=v,t._dbInfo=n;for(var w=0;w<h.length;w++){var k=h[w];k!==t&&(k._dbInfo.db=n.db,k._dbInfo.version=n.version)}})}function Rn(e,t){var n=this;e=$(e);var i=new b(function(u,r){n.ready().then(function(){K(n._dbInfo,ne,function(l,f){if(l)return r(l);try{var p=f.objectStore(n._dbInfo.storeName),h=p.get(e);h.onsuccess=function(){var v=h.result;v===void 0&&(v=null),Ve(v)&&(v=re(v)),u(v)},h.onerror=function(){r(h.error)}}catch(v){r(v)}})}).catch(r)});return x(i,t),i}function Fn(e,t){var n=this,i=new b(function(u,r){n.ready().then(function(){K(n._dbInfo,ne,function(l,f){if(l)return r(l);try{var p=f.objectStore(n._dbInfo.storeName),h=p.openCursor(),v=1;h.onsuccess=function(){var w=h.result;if(w){var k=w.value;Ve(k)&&(k=re(k));var T=e(k,w.key,v++);T!==void 0?u(T):w.continue()}else u()},h.onerror=function(){r(h.error)}}catch(w){r(w)}})}).catch(r)});return x(i,t),i}function $n(e,t,n){var i=this;e=$(e);var u=new b(function(r,l){var f;i.ready().then(function(){return f=i._dbInfo,Ae.call(t)==="[object Blob]"?N(f.db).then(function(p){return p?t:Se(t)}):t}).then(function(p){K(i._dbInfo,d,function(h,v){if(h)return l(h);try{var w=v.objectStore(i._dbInfo.storeName);p===null&&(p=void 0);var k=w.put(p,e);v.oncomplete=function(){p===void 0&&(p=null),r(p)},v.onabort=v.onerror=function(){var T=k.error?k.error:k.transaction.error;l(T)}}catch(T){l(T)}})}).catch(l)});return x(u,n),u}function Bn(e,t){var n=this;e=$(e);var i=new b(function(u,r){n.ready().then(function(){K(n._dbInfo,d,function(l,f){if(l)return r(l);try{var p=f.objectStore(n._dbInfo.storeName),h=p.delete(e);f.oncomplete=function(){u()},f.onerror=function(){r(h.error)},f.onabort=function(){var v=h.error?h.error:h.transaction.error;r(v)}}catch(v){r(v)}})}).catch(r)});return x(i,t),i}function jn(e){var t=this,n=new b(function(i,u){t.ready().then(function(){K(t._dbInfo,d,function(r,l){if(r)return u(r);try{var f=l.objectStore(t._dbInfo.storeName),p=f.clear();l.oncomplete=function(){i()},l.onabort=l.onerror=function(){var h=p.error?p.error:p.transaction.error;u(h)}}catch(h){u(h)}})}).catch(u)});return x(n,e),n}function Mn(e){var t=this,n=new b(function(i,u){t.ready().then(function(){K(t._dbInfo,ne,function(r,l){if(r)return u(r);try{var f=l.objectStore(t._dbInfo.storeName),p=f.count();p.onsuccess=function(){i(p.result)},p.onerror=function(){u(p.error)}}catch(h){u(h)}})}).catch(u)});return x(n,e),n}function Ln(e,t){var n=this,i=new b(function(u,r){if(e<0){u(null);return}n.ready().then(function(){K(n._dbInfo,ne,function(l,f){if(l)return r(l);try{var p=f.objectStore(n._dbInfo.storeName),h=!1,v=p.openKeyCursor();v.onsuccess=function(){var w=v.result;if(!w){u(null);return}e===0||h?u(w.key):(h=!0,w.advance(e))},v.onerror=function(){r(v.error)}}catch(w){r(w)}})}).catch(r)});return x(i,t),i}function qn(e){var t=this,n=new b(function(i,u){t.ready().then(function(){K(t._dbInfo,ne,function(r,l){if(r)return u(r);try{var f=l.objectStore(t._dbInfo.storeName),p=f.openKeyCursor(),h=[];p.onsuccess=function(){var v=p.result;if(!v){i(h);return}h.push(v.key),v.continue()},p.onerror=function(){u(p.error)}}catch(v){u(v)}})}).catch(u)});return x(n,e),n}function Un(e,t){t=V.apply(this,arguments);var n=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i=this,u;if(!e.name)u=b.reject("Invalid arguments");else{var r=e.name===n.name&&i._dbInfo.db,l=r?b.resolve(i._dbInfo.db):Y(e).then(function(f){var p=j[e.name],h=p.forages;p.db=f;for(var v=0;v<h.length;v++)h[v]._dbInfo.db=f;return f});e.storeName?u=l.then(function(f){if(f.objectStoreNames.contains(e.storeName)){var p=f.version+1;M(e);var h=j[e.name],v=h.forages;f.close();for(var w=0;w<v.length;w++){var k=v[w];k._dbInfo.db=null,k._dbInfo.version=p}var T=new b(function(C,F){var P=I.open(e.name,p);P.onerror=function(z){var ae=P.result;ae.close(),F(z)},P.onupgradeneeded=function(){var z=P.result;z.deleteObjectStore(e.storeName)},P.onsuccess=function(){var z=P.result;z.close(),C(z)}});return T.then(function(C){h.db=C;for(var F=0;F<v.length;F++){var P=v[F];P._dbInfo.db=C,L(P._dbInfo)}}).catch(function(C){throw(q(e,C)||b.resolve()).catch(function(){}),C})}}):u=l.then(function(f){M(e);var p=j[e.name],h=p.forages;f.close();for(var v=0;v<h.length;v++){var w=h[v];w._dbInfo.db=null}var k=new b(function(T,C){var F=I.deleteDatabase(e.name);F.onerror=function(){var P=F.result;P&&P.close(),C(F.error)},F.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},F.onsuccess=function(){var P=F.result;P&&P.close(),T(P)}});return k.then(function(T){p.db=T;for(var C=0;C<h.length;C++){var F=h[C];L(F._dbInfo)}}).catch(function(T){throw(q(e,T)||b.resolve()).catch(function(){}),T})})}return x(u,t),u}var zn={_driver:"asyncStorage",_initStorage:Pn,_support:S(),iterate:Fn,getItem:Rn,setItem:$n,removeItem:Bn,clear:jn,length:Mn,key:Ln,keys:qn,dropInstance:Un};function Gn(){return typeof openDatabase=="function"}var Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vn="~~local_forage_type~",He=/^~~local_forage_type~([^~]+)~/,ye="__lfsc__:",Oe=ye.length,Te="arbf",Ce="blob",Xe="si08",Ye="ui08",Ke="uic8",Je="si16",Ze="si32",Qe="ur16",en="ui32",nn="fl32",tn="fl64",rn=Oe+Te.length,sn=Object.prototype.toString;function un(e){var t=e.length*.75,n=e.length,i,u=0,r,l,f,p;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var h=new ArrayBuffer(t),v=new Uint8Array(h);for(i=0;i<n;i+=4)r=Z.indexOf(e[i]),l=Z.indexOf(e[i+1]),f=Z.indexOf(e[i+2]),p=Z.indexOf(e[i+3]),v[u++]=r<<2|l>>4,v[u++]=(l&15)<<4|f>>2,v[u++]=(f&3)<<6|p&63;return h}function Ne(e){var t=new Uint8Array(e),n="",i;for(i=0;i<t.length;i+=3)n+=Z[t[i]>>2],n+=Z[(t[i]&3)<<4|t[i+1]>>4],n+=Z[(t[i+1]&15)<<2|t[i+2]>>6],n+=Z[t[i+2]&63];return t.length%3===2?n=n.substring(0,n.length-1)+"=":t.length%3===1&&(n=n.substring(0,n.length-2)+"=="),n}function Wn(e,t){var n="";if(e&&(n=sn.call(e)),e&&(n==="[object ArrayBuffer]"||e.buffer&&sn.call(e.buffer)==="[object ArrayBuffer]")){var i,u=ye;e instanceof ArrayBuffer?(i=e,u+=Te):(i=e.buffer,n==="[object Int8Array]"?u+=Xe:n==="[object Uint8Array]"?u+=Ye:n==="[object Uint8ClampedArray]"?u+=Ke:n==="[object Int16Array]"?u+=Je:n==="[object Uint16Array]"?u+=Qe:n==="[object Int32Array]"?u+=Ze:n==="[object Uint32Array]"?u+=en:n==="[object Float32Array]"?u+=nn:n==="[object Float64Array]"?u+=tn:t(new Error("Failed to get type for BinaryArray"))),t(u+Ne(i))}else if(n==="[object Blob]"){var r=new FileReader;r.onload=function(){var l=Vn+e.type+"~"+Ne(this.result);t(ye+Ce+l)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(l){console.error("Couldn't convert value into a JSON string: ",e),t(null,l)}}function Hn(e){if(e.substring(0,Oe)!==ye)return JSON.parse(e);var t=e.substring(rn),n=e.substring(Oe,rn),i;if(n===Ce&&He.test(t)){var u=t.match(He);i=u[1],t=t.substring(u[0].length)}var r=un(t);switch(n){case Te:return r;case Ce:return G([r],{type:i});case Xe:return new Int8Array(r);case Ye:return new Uint8Array(r);case Ke:return new Uint8ClampedArray(r);case Je:return new Int16Array(r);case Qe:return new Uint16Array(r);case Ze:return new Int32Array(r);case en:return new Uint32Array(r);case nn:return new Float32Array(r);case tn:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}}var De={serialize:Wn,deserialize:Hn,stringToBuffer:un,bufferToString:Ne};function on(e,t,n,i){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,i)}function Xn(e){var t=this,n={db:null};if(e)for(var i in e)n[i]=typeof e[i]!="string"?e[i].toString():e[i];var u=new b(function(r,l){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(f){return l(f)}n.db.transaction(function(f){on(f,n,function(){t._dbInfo=n,r()},function(p,h){l(h)})},l)});return n.serializer=De,u}function Q(e,t,n,i,u,r){e.executeSql(n,i,u,function(l,f){f.code===f.SYNTAX_ERR?l.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(p,h){h.rows.length?r(p,f):on(p,t,function(){p.executeSql(n,i,u,r)},r)},r):r(l,f)},r)}function Yn(e,t){var n=this;e=$(e);var i=new b(function(u,r){n.ready().then(function(){var l=n._dbInfo;l.db.transaction(function(f){Q(f,l,"SELECT * FROM "+l.storeName+" WHERE key = ? LIMIT 1",[e],function(p,h){var v=h.rows.length?h.rows.item(0).value:null;v&&(v=l.serializer.deserialize(v)),u(v)},function(p,h){r(h)})})}).catch(r)});return x(i,t),i}function Kn(e,t){var n=this,i=new b(function(u,r){n.ready().then(function(){var l=n._dbInfo;l.db.transaction(function(f){Q(f,l,"SELECT * FROM "+l.storeName,[],function(p,h){for(var v=h.rows,w=v.length,k=0;k<w;k++){var T=v.item(k),C=T.value;if(C&&(C=l.serializer.deserialize(C)),C=e(C,T.key,k+1),C!==void 0){u(C);return}}u()},function(p,h){r(h)})})}).catch(r)});return x(i,t),i}function an(e,t,n,i){var u=this;e=$(e);var r=new b(function(l,f){u.ready().then(function(){t===void 0&&(t=null);var p=t,h=u._dbInfo;h.serializer.serialize(t,function(v,w){w?f(w):h.db.transaction(function(k){Q(k,h,"INSERT OR REPLACE INTO "+h.storeName+" (key, value) VALUES (?, ?)",[e,v],function(){l(p)},function(T,C){f(C)})},function(k){if(k.code===k.QUOTA_ERR){if(i>0){l(an.apply(u,[e,p,n,i-1]));return}f(k)}})})}).catch(f)});return x(r,n),r}function Jn(e,t,n){return an.apply(this,[e,t,n,1])}function Zn(e,t){var n=this;e=$(e);var i=new b(function(u,r){n.ready().then(function(){var l=n._dbInfo;l.db.transaction(function(f){Q(f,l,"DELETE FROM "+l.storeName+" WHERE key = ?",[e],function(){u()},function(p,h){r(h)})})}).catch(r)});return x(i,t),i}function Qn(e){var t=this,n=new b(function(i,u){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(l){Q(l,r,"DELETE FROM "+r.storeName,[],function(){i()},function(f,p){u(p)})})}).catch(u)});return x(n,e),n}function et(e){var t=this,n=new b(function(i,u){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(l){Q(l,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],function(f,p){var h=p.rows.item(0).c;i(h)},function(f,p){u(p)})})}).catch(u)});return x(n,e),n}function nt(e,t){var n=this,i=new b(function(u,r){n.ready().then(function(){var l=n._dbInfo;l.db.transaction(function(f){Q(f,l,"SELECT key FROM "+l.storeName+" WHERE id = ? LIMIT 1",[e+1],function(p,h){var v=h.rows.length?h.rows.item(0).key:null;u(v)},function(p,h){r(h)})})}).catch(r)});return x(i,t),i}function tt(e){var t=this,n=new b(function(i,u){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(l){Q(l,r,"SELECT key FROM "+r.storeName,[],function(f,p){for(var h=[],v=0;v<p.rows.length;v++)h.push(p.rows.item(v).key);i(h)},function(f,p){u(p)})})}).catch(u)});return x(n,e),n}function rt(e){return new b(function(t,n){e.transaction(function(i){i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(u,r){for(var l=[],f=0;f<r.rows.length;f++)l.push(r.rows.item(f).name);t({db:e,storeNames:l})},function(u,r){n(r)})},function(i){n(i)})})}function it(e,t){t=V.apply(this,arguments);var n=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i=this,u;return e.name?u=new b(function(r){var l;e.name===n.name?l=i._dbInfo.db:l=openDatabase(e.name,"","",0),e.storeName?r({db:l,storeNames:[e.storeName]}):r(rt(l))}).then(function(r){return new b(function(l,f){r.db.transaction(function(p){function h(T){return new b(function(C,F){p.executeSql("DROP TABLE IF EXISTS "+T,[],function(){C()},function(P,z){F(z)})})}for(var v=[],w=0,k=r.storeNames.length;w<k;w++)v.push(h(r.storeNames[w]));b.all(v).then(function(){l()}).catch(function(T){f(T)})},function(p){f(p)})})}):u=b.reject("Invalid arguments"),x(u,t),u}var st={_driver:"webSQLStorage",_initStorage:Xn,_support:Gn(),iterate:Kn,getItem:Yn,setItem:Jn,removeItem:Zn,clear:Qn,length:et,key:nt,keys:tt,dropInstance:it};function ut(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ln(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function ot(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function at(){return!ot()||localStorage.length>0}function lt(e){var t=this,n={};if(e)for(var i in e)n[i]=e[i];return n.keyPrefix=ln(e,t._defaultConfig),at()?(t._dbInfo=n,n.serializer=De,b.resolve()):b.reject()}function ct(e){var t=this,n=t.ready().then(function(){for(var i=t._dbInfo.keyPrefix,u=localStorage.length-1;u>=0;u--){var r=localStorage.key(u);r.indexOf(i)===0&&localStorage.removeItem(r)}});return x(n,e),n}function ft(e,t){var n=this;e=$(e);var i=n.ready().then(function(){var u=n._dbInfo,r=localStorage.getItem(u.keyPrefix+e);return r&&(r=u.serializer.deserialize(r)),r});return x(i,t),i}function pt(e,t){var n=this,i=n.ready().then(function(){for(var u=n._dbInfo,r=u.keyPrefix,l=r.length,f=localStorage.length,p=1,h=0;h<f;h++){var v=localStorage.key(h);if(v.indexOf(r)===0){var w=localStorage.getItem(v);if(w&&(w=u.serializer.deserialize(w)),w=e(w,v.substring(l),p++),w!==void 0)return w}}});return x(i,t),i}function ht(e,t){var n=this,i=n.ready().then(function(){var u=n._dbInfo,r;try{r=localStorage.key(e)}catch{r=null}return r&&(r=r.substring(u.keyPrefix.length)),r});return x(i,t),i}function yt(e){var t=this,n=t.ready().then(function(){for(var i=t._dbInfo,u=localStorage.length,r=[],l=0;l<u;l++){var f=localStorage.key(l);f.indexOf(i.keyPrefix)===0&&r.push(f.substring(i.keyPrefix.length))}return r});return x(n,e),n}function vt(e){var t=this,n=t.keys().then(function(i){return i.length});return x(n,e),n}function dt(e,t){var n=this;e=$(e);var i=n.ready().then(function(){var u=n._dbInfo;localStorage.removeItem(u.keyPrefix+e)});return x(i,t),i}function mt(e,t,n){var i=this;e=$(e);var u=i.ready().then(function(){t===void 0&&(t=null);var r=t;return new b(function(l,f){var p=i._dbInfo;p.serializer.serialize(t,function(h,v){if(v)f(v);else try{localStorage.setItem(p.keyPrefix+e,h),l(r)}catch(w){(w.name==="QuotaExceededError"||w.name==="NS_ERROR_DOM_QUOTA_REACHED")&&f(w),f(w)}})})});return x(u,n),u}function gt(e,t){if(t=V.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var i=this,u;return e.name?u=new b(function(r){e.storeName?r(ln(e,i._defaultConfig)):r(e.name+"/")}).then(function(r){for(var l=localStorage.length-1;l>=0;l--){var f=localStorage.key(l);f.indexOf(r)===0&&localStorage.removeItem(f)}}):u=b.reject("Invalid arguments"),x(u,t),u}var bt={_driver:"localStorageWrapper",_initStorage:lt,_support:ut(),iterate:pt,getItem:ft,setItem:mt,removeItem:dt,clear:ct,length:vt,key:ht,keys:yt,dropInstance:gt},wt=function(t,n){return t===n||typeof t=="number"&&typeof n=="number"&&isNaN(t)&&isNaN(n)},Et=function(t,n){for(var i=t.length,u=0;u<i;){if(wt(t[u],n))return!0;u++}return!1},cn=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},oe={},fn={},ie={INDEXEDDB:zn,WEBSQL:st,LOCALSTORAGE:bt},xt=[ie.INDEXEDDB._driver,ie.WEBSQL._driver,ie.LOCALSTORAGE._driver],ve=["dropInstance"],Pe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ve),kt={description:"",driver:xt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function _t(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function Re(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(cn(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var It=function(){function e(t){A(this,e);for(var n in ie)if(ie.hasOwnProperty(n)){var i=ie[n],u=i._driver;this[n]=u,oe[u]||this.defineDriver(i)}this._defaultConfig=Re({},kt),this._config=Re({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(n){if((typeof n>"u"?"undefined":E(n))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in n){if(i==="storeName"&&(n[i]=n[i].replace(/\W/g,"_")),i==="version"&&typeof n[i]!="number")return new Error("Database version must be a number.");this._config[i]=n[i]}return"driver"in n&&n.driver?this.setDriver(this._config.driver):!0}else return typeof n=="string"?this._config[n]:this._config},e.prototype.defineDriver=function(n,i,u){var r=new b(function(l,f){try{var p=n._driver,h=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!n._driver){f(h);return}for(var v=Pe.concat("_initStorage"),w=0,k=v.length;w<k;w++){var T=v[w],C=!Et(ve,T);if((C||n[T])&&typeof n[T]!="function"){f(h);return}}var F=function(){for(var ae=function(Ot){return function(){var Tt=new Error("Method "+Ot+" is not implemented by the current driver"),pn=b.reject(Tt);return x(pn,arguments[arguments.length-1]),pn}},Fe=0,St=ve.length;Fe<St;Fe++){var $e=ve[Fe];n[$e]||(n[$e]=ae($e))}};F();var P=function(ae){oe[p]&&console.info("Redefining LocalForage driver: "+p),oe[p]=n,fn[p]=ae,l()};"_support"in n?n._support&&typeof n._support=="function"?n._support().then(P,f):P(!!n._support):P(!0)}catch(z){f(z)}});return R(r,i,u),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(n,i,u){var r=oe[n]?b.resolve(oe[n]):b.reject(new Error("Driver not found."));return R(r,i,u),r},e.prototype.getSerializer=function(n){var i=b.resolve(De);return R(i,n),i},e.prototype.ready=function(n){var i=this,u=i._driverSet.then(function(){return i._ready===null&&(i._ready=i._initDriver()),i._ready});return R(u,n,n),u},e.prototype.setDriver=function(n,i,u){var r=this;cn(n)||(n=[n]);var l=this._getSupportedDrivers(n);function f(){r._config.driver=r.driver()}function p(w){return r._extend(w),f(),r._ready=r._initStorage(r._config),r._ready}function h(w){return function(){var k=0;function T(){for(;k<w.length;){var C=w[k];return k++,r._dbInfo=null,r._ready=null,r.getDriver(C).then(p).catch(T)}f();var F=new Error("No available storage method found.");return r._driverSet=b.reject(F),r._driverSet}return T()}}var v=this._driverSet!==null?this._driverSet.catch(function(){return b.resolve()}):b.resolve();return this._driverSet=v.then(function(){var w=l[0];return r._dbInfo=null,r._ready=null,r.getDriver(w).then(function(k){r._driver=k._driver,f(),r._wrapLibraryMethodsWithReady(),r._initDriver=h(l)})}).catch(function(){f();var w=new Error("No available storage method found.");return r._driverSet=b.reject(w),r._driverSet}),R(this._driverSet,i,u),this._driverSet},e.prototype.supports=function(n){return!!fn[n]},e.prototype._extend=function(n){Re(this,n)},e.prototype._getSupportedDrivers=function(n){for(var i=[],u=0,r=n.length;u<r;u++){var l=n[u];this.supports(l)&&i.push(l)}return i},e.prototype._wrapLibraryMethodsWithReady=function(){for(var n=0,i=Pe.length;n<i;n++)_t(this,Pe[n])},e.prototype.createInstance=function(n){return new e(n)},e}(),At=new It;c.exports=At},{3:3}]},{},[4])(4)})});var er={};$t(er,{default:()=>Ie});module.exports=jt(er);var te=require("obsidian");var Be;function yn(a){return{lang:a?.lang??Be?.lang,message:a?.message,abortEarly:a?.abortEarly??Be?.abortEarly,abortPipeEarly:a?.abortPipeEarly??Be?.abortPipeEarly}}var Mt;function Lt(a){return Mt?.get(a)}var qt;function Ut(a){return qt?.get(a)}var zt;function Gt(a,s){return zt?.get(a)?.get(s)}function Vt(a){let s=typeof a;return s==="string"?`"${a}"`:s==="number"||s==="bigint"||s==="boolean"?`${a}`:s==="object"||s==="function"?(a&&Object.getPrototypeOf(a)?.constructor?.name)??"null":s}function se(a,s,o,y,c){let g=c&&"input"in c?c.input:o.value,E=c?.expected??a.expects??null,A=c?.received??Vt(g),m={kind:a.kind,type:a.type,input:g,expected:E,received:A,message:`Invalid ${s}: ${E?`Expected ${E} but r`:"R"}eceived ${A}`,requirement:a.requirement,path:c?.path,issues:c?.issues,lang:y.lang,abortEarly:y.abortEarly,abortPipeEarly:y.abortPipeEarly},I=a.kind==="schema",S=c?.message??a.message??Gt(a.reference,m.lang)??(I?Ut(m.lang):null)??y.message??Lt(m.lang);S!==void 0&&(m.message=typeof S=="function"?S(m):S),I&&(o.typed=!1),o.issues?o.issues.push(m):o.issues=[m]}function le(a){return{version:1,vendor:"valibot",validate(s){return a["~run"]({value:s},yn())}}}function Wt(a,s,o){return typeof a.fallback=="function"?a.fallback(s,o):a.fallback}function Ht(a,s,o){return typeof a.default=="function"?a.default(s,o):a.default}function me(a,s){return{kind:"schema",type:"array",reference:me,expects:"Array",async:!1,item:a,message:s,get"~standard"(){return le(this)},"~run"(o,y){let c=o.value;if(Array.isArray(c)){o.typed=!0,o.value=[];for(let g=0;g<c.length;g++){let E=c[g],A=this.item["~run"]({value:E},y);if(A.issues){let m={type:"array",origin:"value",input:c,key:g,value:E};for(let I of A.issues)I.path?I.path.unshift(m):I.path=[m],o.issues?.push(I);if(o.issues||(o.issues=A.issues),y.abortEarly){o.typed=!1;break}}A.typed||(o.typed=!1),o.value.push(A.value)}}else se(this,"type",o,y);return o}}}function ce(a){return{kind:"schema",type:"boolean",reference:ce,expects:"boolean",async:!1,message:a,get"~standard"(){return le(this)},"~run"(s,o){return typeof s.value=="boolean"?s.typed=!0:se(this,"type",s,o),s}}}function je(a){return{kind:"schema",type:"number",reference:je,expects:"number",async:!1,message:a,get"~standard"(){return le(this)},"~run"(s,o){return typeof s.value=="number"&&!isNaN(s.value)?s.typed=!0:se(this,"type",s,o),s}}}function ge(a,s){return{kind:"schema",type:"object",reference:ge,expects:"Object",async:!1,entries:a,message:s,get"~standard"(){return le(this)},"~run"(o,y){let c=o.value;if(c&&typeof c=="object"){o.typed=!0,o.value={};for(let g in this.entries){let E=this.entries[g];if(g in c||(E.type==="exact_optional"||E.type==="optional"||E.type==="nullish")&&E.default!==void 0){let A=g in c?c[g]:Ht(E),m=E["~run"]({value:A},y);if(m.issues){let I={type:"object",origin:"value",input:c,key:g,value:A};for(let S of m.issues)S.path?S.path.unshift(I):S.path=[I],o.issues?.push(S);if(o.issues||(o.issues=m.issues),y.abortEarly){o.typed=!1;break}}m.typed||(o.typed=!1),o.value[g]=m.value}else if(E.fallback!==void 0)o.value[g]=Wt(E);else if(E.type!=="exact_optional"&&E.type!=="optional"&&E.type!=="nullish"&&(se(this,"key",o,y,{input:void 0,expected:`"${g}"`,path:[{type:"object",origin:"key",input:c,key:g,value:c[g]}]}),y.abortEarly))break}}else se(this,"type",o,y);return o}}}function H(a){return{kind:"schema",type:"string",reference:H,expects:"string",async:!1,message:a,get"~standard"(){return le(this)},"~run"(s,o){return typeof s.value=="string"?s.typed=!0:se(this,"type",s,o),s}}}async function vn(a,s,o){let y=await a["~run"]({value:s},yn(o));return{typed:y.typed,success:!y.issues,output:y.value,issues:y.issues}}var Cn=Bt(mn());var{isArray:rr}=Array;var{keys:ir}=Object;function gn(a){return s=>Object.assign({},a||{},s||{})}async function bn(a){let s=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(s)).map(c=>c.toString(16).padStart(2,"0")).join("")}var or=ge({tinypngApiKey:H(),tinypngBaseUrl:H(),concurrency:je(),compressAllowedFoldersOnly:ce(),cacheFilePath:H(),allowedFolders:me(H()),ignoredFolders:me(H()),extraImageFormats:H(),compressOnPaste:ce(),compressOnFileSystemImageCreated:ce()}),wn=ge({_NOTICE:H(),j:H()});async function be(a){return await a.app.vault.adapter.exists(a.settings.cacheFilePath)||await a.app.vault.create(a.settings.cacheFilePath,"{}"),a.settings.cacheFilePath}function Kt(a){return`${encodeURIComponent(a.name)}-${String(a.stat.size)}`}async function En(a){let s=await a.vault.readBinary(a),o=new Uint8Array(s);return await bn(o)}async function we(a,s){let o=a.imageHashes,y=Kt(s),c=o.get(y)===1,g=await En(s),E=o.get(g)===1;return c||E}async function Ee(a,s){let o=await En(s);await a.saveImageCacheToLocalFile(o,1);let y=await a.forage.getItem("pending-compression-count");if(!y)return;let c=Number(y)-1;if(c>0){await a.forage.setItem("pending-compression-count",c);return}await a.forage.removeItem("pending-compression-count")}async function xn(a){let s=await be(a);await a.app.vault.adapter.write(s,"{}")}var ee=require("obsidian");var Zt=["png","jpg","jpeg","webp"];function fe(a){return a.app.vault.getFiles().filter(o=>Ue(a,o))}function Le(a,s){let o=s.extension;return[...a.settings.extraImageFormats.split(","),...Zt].includes(o)}function qe(a,s){let o=a.settings.ignoredFolders.some(y=>s.path.startsWith(y));return a.settings.compressAllowedFoldersOnly&&(o=!a.settings.allowedFolders.some(y=>s.path.startsWith(y))),!o}function Ue(a,s){let o=Le(a,s),y=qe(a,s);return o&&!y}async function xe(a,s,o=!0){try{if(o&&await we(a,s))return 1;let y=`${a.settings.tinypngBaseUrl}/shrink`,c=btoa(`api:${a.settings.tinypngApiKey}`),g=await(0,ee.request)({url:y,method:"POST",headers:{Authorization:`Basic ${c}`},body:await a.app.vault.readBinary(s)}),E=JSON.parse(g).output.url;if(!E)return 2;let A=await(0,ee.requestUrl)(E);return await a.app.vault.modifyBinary(s,A.arrayBuffer),await Ee(a,s),0}catch(y){return y instanceof Error&&console.error(y.message),2}}async function ze(a,s){if(!a.settings.tinypngApiKey){new ee.Notice("Please enter an API key in the settings.");return}if(await a.forage.getItem("compression-status")===1){let I=await a.forage.getItem("pending-compression-count");new ee.Notice(I?`There are ${I} images awaiting compression.`:"Compression is already in progress.");return}await a.forage.setItem("compression-status",1),await a.forage.setItem("pending-compression-count",s.length);let c=a.settings.concurrency,g=0,E=0,A=0,m=[];for(let I of s)m.push(xe(a,I).then(S=>{switch(S){case 0:{g++;break}case 1:{E++;break}case 2:{A++;break}}}).catch(S=>{console.error(S),A++})),m.length>=c&&(await Promise.all(m),m.length=0);await Promise.all(m),await a.forage.setItem("compression-status",0),new ee.Notice(`Compression complete. Success: ${g}, Ignored: ${E}, Failed: ${A}`)}var kn=".tinypng-image-cache.json",Ge="7gT#5Z@8L^1pQ&3J*6K$9V+0bD%2eR!4fY";var _n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 5v14M19 12l-7 7-7-7"/>
</svg>
`;var ke=require("obsidian"),J=class extends ke.Modal{onConfirm;onCancel;warningMessage;constructor(s,o,y,c="This action cannot be undone, please confirm to proceed."){super(s),this.onConfirm=o,y&&(this.onCancel=y),this.warningMessage=c}onOpen(){let{contentEl:s,onCancel:o}=this;this.setTitle("Are you sure you want to proceed?"),s.createEl("p",{text:this.warningMessage}),new ke.Setting(s).addButton(y=>y.setButtonText("Confirm").setCta().onClick(async()=>{this.close(),await this.onConfirm()})).addButton(y=>y.setButtonText("Cancel").setCta().onClick(async()=>{this.close(),o&&await o()}))}onClose(){let{contentEl:s}=this;s.empty()}};var In=a=>[...a].reverse().join(""),An=(a,s)=>[...a].map((o,y)=>String.fromCharCode(o.charCodeAt(0)^s.charCodeAt(y%s.length))).join(""),Sn=a=>{if(!a?.j)return;let s=a.j;return s=In(s),s=An(s,Ge),JSON.parse(s)},On=a=>{if(a==null)return;let s=JSON.stringify(a);return s=An(s,Ge),s=In(s),{_NOTICE:"DO NOT MODIFY THIS CONFIGURATION OR SHARE IT WITH ANYONE. IT SHOULD BE KEPT SECRET AND SECURE AT ALL TIMES. FAILURE TO COMPLY MAY DISRUPT THE FUNCTIONALITY OF THE SYSTEM.",j:s}};var D=require("obsidian");var W=require("obsidian");var pe=class extends W.Modal{path;mode;plugin;constructor(s,o){super(s.app),this.path="",this.plugin=s,this.mode=o}getObject(){return this.mode==="allowed"?this.plugin.settings.allowedFolders:this.plugin.settings.ignoredFolders}async submitForm(){if(this.path===""){new W.Notice("Please fill out all fields");return}if(this.getObject().includes(this.path)){new W.Notice(`Path already exists in ${this.mode} folders`);return}if(!await this.plugin.app.vault.adapter.exists(this.path,!0)){new W.Notice("Path does not exist");return}if(!this.plugin.app.vault.getFolderByPath(this.path)){new W.Notice("Path is not a valid folder");return}this.getObject().push(this.path),await this.plugin.saveSettings(),new W.Notice(`Added ${this.path} to ${this.mode} folders`),this.close()}onOpen(){let{contentEl:s,path:o}=this;this.setTitle(`Add ${this.mode} Folder`),new W.Setting(s).setName("Path:").addText(y=>{y.onChange(c=>{this.path=c}),y.setValue(o)}),new W.Setting(s).addButton(y=>y.setButtonText("Confirm").setCta().onClick(async()=>{await this.submitForm()}))}async onClose(){let{contentEl:s,plugin:o}=this;s.empty(),await o.app.setting.open(),await o.app.setting.openTabById(o.manifest.id)}};var _e=class extends D.PluginSettingTab{plugin;constructor(s){super(s.app,s),this.plugin=s}createFragmentWithHTML=s=>createFragment(o=>{let y=o.createDiv();y.innerHTML=s});async restartSettingsTab(){await this.plugin.app.setting.close(),await this.plugin.app.setting.open(),await this.plugin.app.setting.openTabById(this.plugin.manifest.id)}display(){let{containerEl:s,plugin:o,app:y}=this;if(s.empty(),new D.Setting(s).setName("API Key").setDesc(this.createFragmentWithHTML('API Key for the tinypng service, you can get one <a href="https://tinify.com/dashboard/api" target="_blank">here</a>')).addText(c=>c.setPlaceholder("Enter your secret").setValue(o.settings.tinypngApiKey).onChange(async g=>{o.settings.tinypngApiKey=g,await o.saveSettings()})),new D.Setting(s).setName("TinyPNG Base URL").setDesc(this.createFragmentWithHTML("Base URL for the tinypng service, defaults to <code>https://api.tinify.com</code>")).addText(c=>c.setPlaceholder("Enter your base URL").setValue(o.settings.tinypngBaseUrl).onChange(async g=>{o.settings.tinypngBaseUrl=g,await o.saveSettings()})),new D.Setting(s).setName("Compress Allowed Folders Only").setDesc("Compress the allowed folder only. If no, then it will compress all folders except ignored folders.").addToggle(c=>{c.setValue(o.settings.compressAllowedFoldersOnly).onChange(async g=>{o.settings.compressAllowedFoldersOnly=g,await o.saveSettings(),await this.restartSettingsTab()})}),new D.Setting(s).setName("Concurrency").setDesc("Number of images to compress at once").addDropdown(c=>{c.addOption("1","1").addOption("5","5 (Default)").addOption("10","10").addOption("20","20").addOption("50","50 (High CPU Usage)").setValue(o.settings.concurrency.toString()).onChange(async g=>{o.settings.concurrency=Number.parseInt(g),await o.saveSettings()})}),new D.Setting(s).setName("Extra Image Formats").setDesc("Enter the extra image formats to compress, separated by commas, do not include dot or space").addTextArea(c=>{c.setPlaceholder("png,jpg,webp").setValue(o.settings.extraImageFormats).onChange(async g=>{/^[a-zA-Z,]+$/.test(g)&&(o.settings.extraImageFormats=g,await o.saveSettings())})}),new D.Setting(s).setName("Cache File Path").setDesc(this.createFragmentWithHTML("<b>DANGER:</b> This setting is for advanced users. Changing the cache file path can lead to data inconsistencies and redundant API calls. If you change this path, make sure to manually copy the cache file to the new location.")).addText(c=>{c.setPlaceholder("Enter the path for the cache file").setValue(o.settings.cacheFilePath).onChange(async g=>{o.settings.cacheFilePath=g,await o.saveSettings()})}),new D.Setting(s).setName("Reset Local Store").setDesc(this.createFragmentWithHTML("<b>This is a debug option!</b> This will reset the local store, which can fix some temporary issues.")).addButton(c=>{c.setButtonText("Reset").onClick(()=>{new J(y,async()=>{await this.plugin.forage.clear(),new D.Notice("Local store has been reset")}).open()})}),new D.Setting(s).setName("Save all image to cache without compression").setDesc(this.createFragmentWithHTML("<b>This is a debug option!</b> If you are certain that all images are compressed and you have lost the cache file, you can use this option to temporarily recover the cache file.")).addButton(c=>{c.setButtonText("Reset").onClick(()=>{new J(y,async()=>{let g=fe(o);for(let E of g)await Ee(o,E);new D.Notice("All images have been added to the cache")}).open()})}),new D.Setting(s).setName("Clear all images records from cache").setDesc(this.createFragmentWithHTML("<b>This is a debug and VERY DANGEROUS option!</b> You will lose all the records of the images that have been compressed. This will not delete the images themselves, but you will be compressing them again.")).addButton(c=>{c.setButtonText("Reset").onClick(()=>{new J(y,async()=>{await xn(o),new D.Notice("All images have been removed from the cache")}).open()})}),s.createEl("h2",{text:"Editor Behavior"}),s.createEl("p",{text:"Reminder: This is constrained by allowed and disallowed folders, which can be configured in the bottom."}),new D.Setting(s).setName("Compress on paste").setDesc("Compress images when pasted into the editor, disable this option if you encounter compatibility issues with other plugins.").addToggle(c=>{c.setValue(o.settings.compressOnPaste).onChange(async g=>{o.settings.compressOnPaste=g,await o.saveSettings()})}),new D.Setting(s).setName("Compress on new file").setDesc("All new created image in the vault will be compressed, no matter how it is formed.").addToggle(c=>{c.setValue(o.settings.compressOnFileSystemImageCreated).onChange(async g=>{o.settings.compressOnFileSystemImageCreated=g,await o.saveSettings()})}),o.settings.compressAllowedFoldersOnly){s.createEl("h2",{text:"Allowed Folders"}),new D.Setting(s).setName("Add").setDesc("Add a folder to the allowed folders list").addButton(c=>{c.setButtonText("Add").onClick(async()=>{await o.app.setting.close(),new pe(o,"allowed").open()})});for(let c of o.settings.allowedFolders){let E=`${o.settings.allowedFolders.indexOf(c)+1}: <code>${c}</code>`;this.plugin.app.vault.getFolderByPath(c)||(E+=" <strong>(Not found)</strong>"),new D.Setting(s).setName(this.createFragmentWithHTML(E)).addButton(m=>{m.setIcon("cross"),m.setTooltip("Delete this folder from the allowed folders list"),m.onClick(async()=>{m.buttonEl.textContent===""?(m.setButtonText("Click once more to confirm removal"),setTimeout(()=>{m.setIcon("cross")},5e3)):(m.buttonEl.parentElement?.parentElement&&m.buttonEl.parentElement.parentElement.remove(),o.settings.allowedFolders=o.settings.allowedFolders.filter(I=>I!==c),await o.saveSettings())})})}}s.createEl("h2",{text:"Ignored Folders"}),new D.Setting(s).setName("Add").setDesc("Add a folder to the ignored folders list").addButton(c=>{c.setButtonText("Add").onClick(async()=>{await o.app.setting.close(),new pe(o,"ignored").open()})});for(let c of o.settings.ignoredFolders){let g=o.settings.ignoredFolders.indexOf(c)+1,E=`${g}: <code>${c}</code>`;o.app.vault.getAbstractFileByPath(c)||(E+=" <strong>(Not found)</strong>"),new D.Setting(s).setName(this.createFragmentWithHTML(`${g}: <code>${c}</code>`)).addButton(m=>{m.setIcon("cross"),m.setTooltip("Delete this folder from the ignored folders list"),m.onClick(async()=>{m.buttonEl.textContent===""?(m.setButtonText("Click once more to confirm removal"),setTimeout(()=>{m.setIcon("cross")},5e3)):(m.buttonEl.parentElement?.parentElement&&m.buttonEl.parentElement.parentElement.remove(),o.settings.ignoredFolders=o.settings.ignoredFolders.filter(I=>I!==c),await o.saveSettings())})})}}};var Tn={tinypngApiKey:"",tinypngBaseUrl:"https://api.tinify.com",concurrency:5,ignoredFolders:[],allowedFolders:[],cacheFilePath:kn,compressAllowedFoldersOnly:!1,extraImageFormats:"png,webp",compressOnPaste:!1,compressOnFileSystemImageCreated:!1},Ie=class extends te.Plugin{settings;forage;imageHashes;async onload(){await this.loadSettings(),await this.loadImageCacheFromLocalFile(),this.forage=Cn.createInstance({name:`${this.manifest.id}-${this.app.appId}`}),(0,te.addIcon)("compress",_n),this.addRibbonIcon("compress","Compress images",async()=>{let s=fe(this);await ze(this,s)}),this.addCommand({id:"compress-images",name:"Compress images in the current vault",callback:async()=>{let s=fe(this);await ze(this,s)}}),this.addSettingTab(new _e(this)),this.app.workspace.onLayoutReady(()=>{this.registerEvent(this.app.vault.on("create",s=>this.onFileCreated(this,s)))}),this.registerEvent(this.app.workspace.on("file-menu",(s,o)=>{let y=this.app.vault.getFileByPath(o.path);!y||!Le(this,y)||s.addItem(g=>{g.setTitle("Compress image"),g.setIcon("compress"),g.onClick(async()=>{await this.onMenuButtonCreate(s,y)})})}))}isImagePasted(s){return s.name.startsWith("Pasted image")}async onMenuButtonCreate(s,o){if(await we(this,o)){new te.Notice(`Image ${o.name} is already compressed`);return}let c=async()=>{console.log(`Compressing ${o.name}`);let g=await xe(this,o);this.showPostCompressionNotice(o,g)};if(!qe(this,o)){let g="This image is located in a folder that may not be intended for compression, do you want to compress it anyway?";new J(this.app,c,void 0,g).open();return}await c()}showPostCompressionNotice(s,o){let y={0:"successfully",2:"failed",1:"aborted, already compressed"};new te.Notice(`Compression ${y[o]}: ${s.name}`)}async onFileCreated(s,o){if(!s.settings.compressOnFileSystemImageCreated&&(!s.isImagePasted(o)||!s.settings.compressOnPaste))return;let c=s.app.vault.getFileByPath(o.path);if(!c||!Ue(s,c))return;console.log(`Compressing: ${c.name}`);let g=await xe(s,c);this.showPostCompressionNotice(c,g)}onunload(){this.imageHashes.clear()}async loadImageCacheFromLocalFile(){let s=await be(this),o=await this.app.vault.adapter.read(s),y=JSON.parse(o);this.imageHashes=new Map(Object.entries(y))}async saveImageCacheToLocalFile(s,o){this.imageHashes.set(s,o);let y=await be(this),c=JSON.stringify(Object.fromEntries(this.imageHashes));await this.app.vault.adapter.write(y,c)}async loadSettings(){let s=await this.loadData(),{success:o}=await vn(wn,s);if(!o){this.settings=Tn,console.log("Failed to parse settings, using defaults.");return}this.settings=gn(Tn)(Sn(s))}async saveSettings(){await this.saveData(On(this.settings))}};

/* nosourcemap */